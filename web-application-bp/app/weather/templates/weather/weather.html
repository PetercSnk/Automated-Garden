{% extends "core/core.html" %}
{% block head %}
    <title>Home</title>
    <script src="https://code.highcharts.com/highcharts.js"></script>
{% endblock %}
{% block content %}
    <h1>Weather Forecast</h1>
    <div class="get-weather-btn">
        <form method="post">
            <button type="submit" class="normal-btn" name="get-weather">Get Weather</button>
        </form>
    </div>
    {% if render %}
        <h4>Date: {{ format_date(date) }} Sunrise: {{ sunrise }} Sunset: {{ sunset }}</h4>
        <h4>Weather: {{ description }}</h4>
        <div class="get-day-btns">
            {% for daily in daily_all %}
                <a class="nav-item" href="/weather/{{ daily.id }}">{{ format_date(daily.date) }}</a>
            {% endfor %}
        </div>
        <figure class="highcharts-figure">
            <div id="container"></div>
        </figure>
        <script>
            var time = {{ time | safe }}
            var temperature = {{ temperature | safe }}
            var humidity = {{ humidity | safe }}
            var precipitation_probability = {{ precipitation_probability | safe }}
            var precipitation = {{ precipitation | safe }}
            Highcharts.chart("container", {
                chart: {
                    zooming: {
                        type: "xy"
                    }
                },
                title: {
                    text: "Weather for {{ format_date(date) }}",
                    align: "left"
                },
                xAxis: [{
                    categories: time,
                    crosshair: true
                }],
                yAxis: [{
                    labels: {
                        format: "{value} °C",
                        style: {
                            color: Highcharts.getOptions().colors[0]
                        }
                    },
                    title: {
                        text: "Temperature",
                        style: {
                            color: Highcharts.getOptions().colors[0]
                        }
                    }
                }, {
                    labels: {
                        format: "{value} %",
                        style: {
                            color: Highcharts.getOptions().colors[1]
                        }
                    },
                    title: {
                        text: "Humidity",
                        style: {
                            color: Highcharts.getOptions().colors[1]
                        }
                    }
                }, {
                    labels: {
                        format: "{value} %",
                        style: {
                            color: Highcharts.getOptions().colors[2]
                        }
                    },
                    title: {
                        text: "Precipitation",
                        style: {
                            color: Highcharts.getOptions().colors[2]
                        }
                    },
                    opposite: true
                }, {
                    labels: {
                        format: "{value} mm",
                        style: {
                            color: Highcharts.getOptions().colors[3]
                        }
                    },
                    title: {
                        text: "Precipitation Probability",
                        style: {
                            color: Highcharts.getOptions().colors[3]
                        }
                    },
                    opposite: true
                }],
                tooltip: {
                    shared: true
                },
                legend: {
                    align: "left",
                    verticalAlign: "top",
                    backgroundColor:
                        Highcharts.defaultOptions.legend.backgroundColor ||
                        "rgba(255,255,255,0.25)"
                },
                series: [{
                    name: "Temperature",
                    type: "spline",
                    data: temperature,
                    tooltip: {
                        valueSuffix: " °C"
                    }
                }, {
                    name: "Humidity",
                    type: "spline",
                    yAxis: 1,
                    data: humidity,
                    tooltip: {
                        valueSuffix: " %"
                    }
                }, {
                    name: "Precipitation Probability",
                    type: "spline",
                    yAxis: 2,
                    data: precipitation_probability,
                    tooltip: {
                        valueSuffix: " %"
                    }
                }, {
                    name: "Precipitation",
                    type: "column",
                    yAxis: 3,
                    data: precipitation,
                    tooltip: {
                        valueSuffix: " mm"
                    }
                }]
            });  
        </script>
    {% endif %}
{% endblock %}
